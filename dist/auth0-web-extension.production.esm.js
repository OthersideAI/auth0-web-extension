var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};!function(e){function t(){}function n(e,t){if(e=void 0===e?"utf-8":e,t=void 0===t?{fatal:!1}:t,-1===o.indexOf(e.toLowerCase()))throw new RangeError("Failed to construct 'TextDecoder': The encoding label provided ('"+e+"') is invalid.");if(t.fatal)throw Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}function r(e){for(var t=0,n=Math.min(65536,e.length+1),r=new Uint16Array(n),o=[],i=0;;){var s=t<e.length;if(!s||i>=n-1){if(o.push(String.fromCharCode.apply(null,r.subarray(0,i))),!s)return o.join("");e=e.subarray(t),i=t=0}if(0==(128&(s=e[t++])))r[i++]=s;else if(192==(224&s)){var a=63&e[t++];r[i++]=(31&s)<<6|a}else if(224==(240&s)){a=63&e[t++];var c=63&e[t++];r[i++]=(31&s)<<12|a<<6|c}else if(240==(248&s)){65535<(s=(7&s)<<18|(a=63&e[t++])<<12|(c=63&e[t++])<<6|63&e[t++])&&(s-=65536,r[i++]=s>>>10&1023|55296,s=56320|1023&s),r[i++]=s}}}if(e.TextEncoder&&e.TextDecoder)return!1;var o=["utf-8","utf8","unicode-1-1-utf-8"];Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),t.prototype.encode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to encode: the 'stream' option is unsupported.");t=0;for(var n=e.length,r=0,o=Math.max(32,n+(n>>>1)+7),i=new Uint8Array(o>>>3<<3);t<n;){var s=e.charCodeAt(t++);if(55296<=s&&56319>=s){if(t<n){var a=e.charCodeAt(t);56320==(64512&a)&&(++t,s=((1023&s)<<10)+(1023&a)+65536)}if(55296<=s&&56319>=s)continue}if(r+4>i.length&&(o+=8,o=(o*=1+t/e.length*2)>>>3<<3,(a=new Uint8Array(o)).set(i),i=a),0==(4294967168&s))i[r++]=s;else{if(0==(4294965248&s))i[r++]=s>>>6&31|192;else if(0==(4294901760&s))i[r++]=s>>>12&15|224,i[r++]=s>>>6&63|128;else{if(0!=(4292870144&s))continue;i[r++]=s>>>18&7|240,i[r++]=s>>>12&63|128,i[r++]=s>>>6&63|128}i[r++]=63&s|128}}return i.slice?i.slice(0,r):i.subarray(0,r)},Object.defineProperty(n.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(n.prototype,"fatal",{value:!1}),Object.defineProperty(n.prototype,"ignoreBOM",{value:!1});var i=r;"function"==typeof Buffer&&Buffer.from?i=function(e){return Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf-8")}:"function"==typeof Blob&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&(i=function(e){var t=URL.createObjectURL(new Blob([e],{type:"text/plain;charset=UTF-8"}));try{var n=new XMLHttpRequest;return n.open("GET",t,!1),n.send(),n.responseText}catch(t){return r(e)}finally{URL.revokeObjectURL(t)}}),n.prototype.decode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to decode: the 'stream' option is unsupported.");return e=e instanceof Uint8Array?e:e.buffer instanceof ArrayBuffer?new Uint8Array(e.buffer):new Uint8Array(e),i(e)},e.TextEncoder=t,e.TextDecoder=n}("undefined"!=typeof window?window:e);
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},t(e,n)};function n(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var r=function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)};function o(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}function i(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function a(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=a(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,o,(t=e[n](t)).done,t.value)}))}}}var u={exports:{}};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,function(e){if("undefined"==typeof browser||Object.getPrototypeOf(browser)!==Object.prototype){const t="The message port closed before a response was received.",n="Returning a Promise is the preferred way to send a reply from an onMessage/onMessageExternal listener, as the sendResponse will be removed from the specs (See https://developer.mozilla.org/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage)",r=e=>{const r={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(r).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class o extends WeakMap{constructor(e,t){super(t),this.createItem=e}get(e){return this.has(e)||this.set(e,this.createItem(e)),super.get(e)}}const i=e=>e&&"object"==typeof e&&"function"==typeof e.then,s=(t,n)=>(...r)=>{e.runtime.lastError?t.reject(new Error(e.runtime.lastError.message)):n.singleCallbackArg||r.length<=1&&!1!==n.singleCallbackArg?t.resolve(r[0]):t.resolve(r)},a=e=>1==e?"argument":"arguments",c=(e,t)=>function(n,...r){if(r.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${a(t.minArgs)} for ${e}(), got ${r.length}`);if(r.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${a(t.maxArgs)} for ${e}(), got ${r.length}`);return new Promise(((o,i)=>{if(t.fallbackToNoCallback)try{n[e](...r,s({resolve:o,reject:i},t))}catch(i){console.warn(`${e} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,i),n[e](...r),t.fallbackToNoCallback=!1,t.noCallback=!0,o()}else t.noCallback?(n[e](...r),o()):n[e](...r,s({resolve:o,reject:i},t))}))},u=(e,t,n)=>new Proxy(t,{apply:(t,r,o)=>n.call(r,e,...o)});let l=Function.call.bind(Object.prototype.hasOwnProperty);const d=(e,t={},n={})=>{let r=Object.create(null),o={has:(t,n)=>n in e||n in r,get(o,i,s){if(i in r)return r[i];if(!(i in e))return;let a=e[i];if("function"==typeof a)if("function"==typeof t[i])a=u(e,e[i],t[i]);else if(l(n,i)){let t=c(i,n[i]);a=u(e,e[i],t)}else a=a.bind(e);else if("object"==typeof a&&null!==a&&(l(t,i)||l(n,i)))a=d(a,t[i],n[i]);else{if(!l(n,"*"))return Object.defineProperty(r,i,{configurable:!0,enumerable:!0,get:()=>e[i],set(t){e[i]=t}}),a;a=d(a,t[i],n["*"])}return r[i]=a,a},set:(t,n,o,i)=>(n in r?r[n]=o:e[n]=o,!0),defineProperty:(e,t,n)=>Reflect.defineProperty(r,t,n),deleteProperty:(e,t)=>Reflect.deleteProperty(r,t)},i=Object.create(e);return new Proxy(i,o)},m=e=>({addListener(t,n,...r){t.addListener(e.get(n),...r)},hasListener:(t,n)=>t.hasListener(e.get(n)),removeListener(t,n){t.removeListener(e.get(n))}}),h=new o((e=>"function"!=typeof e?e:function(t){const n=d(t,{},{getContent:{minArgs:0,maxArgs:0}});e(n)}));let g=!1;const f=new o((e=>"function"!=typeof e?e:function(t,r,o){let s,a,c=!1,u=new Promise((e=>{s=function(t){g||(console.warn(n,(new Error).stack),g=!0),c=!0,e(t)}}));try{a=e(t,r,s)}catch(e){a=Promise.reject(e)}const l=!0!==a&&i(a);if(!0!==a&&!l&&!c)return!1;const d=e=>{e.then((e=>{o(e)}),(e=>{let t;t=e&&(e instanceof Error||"string"==typeof e.message)?e.message:"An unexpected error occurred",o({__mozWebExtensionPolyfillReject__:!0,message:t})})).catch((e=>{console.error("Failed to send onMessage rejected reply",e)}))};return d(l?a:u),!0})),p=({reject:n,resolve:r},o)=>{e.runtime.lastError?e.runtime.lastError.message===t?r():n(new Error(e.runtime.lastError.message)):o&&o.__mozWebExtensionPolyfillReject__?n(new Error(o.message)):r(o)},A=(e,t,n,...r)=>{if(r.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${a(t.minArgs)} for ${e}(), got ${r.length}`);if(r.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${a(t.maxArgs)} for ${e}(), got ${r.length}`);return new Promise(((e,t)=>{const o=p.bind(null,{resolve:e,reject:t});r.push(o),n.sendMessage(...r)}))},v={devtools:{network:{onRequestFinished:m(h)}},runtime:{onMessage:m(f),onMessageExternal:m(f),sendMessage:A.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:A.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},w={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return r.privacy={network:{"*":w},services:{"*":w},websites:{"*":w}},d(e,v,r)};if("object"!=typeof chrome||!chrome||!chrome.runtime||!chrome.runtime.id)throw new Error("This script should only be loaded in a browser extension.");e.exports=r(chrome)}else e.exports=browser}(u);var l=u.exports,d=function(){function e(){var e=this;this.locked=new Map,this.addToLocked=function(t,n){var r=e.locked.get(t);void 0===r?void 0===n?e.locked.set(t,[]):e.locked.set(t,[n]):void 0!==n&&(r.unshift(n),e.locked.set(t,r))},this.isLocked=function(t){return e.locked.has(t)},this.lock=function(t){return new Promise((function(n,r){e.isLocked(t)?e.addToLocked(t,n):(e.addToLocked(t),n())}))},this.unlock=function(t){var n=e.locked.get(t);if(void 0!==n&&0!==n.length){var r=n.pop();e.locked.set(t,n),void 0!==r&&setTimeout(r,0)}else e.locked.delete(t)}}return e.getInstance=function(){return void 0===e.instance&&(e.instance=new e),e.instance},e}();function m(){return d.getInstance()}var h=function(){return crypto||window.msCrypto},g=function(){var e=h();return e.subtle||e.webkitSubtle},f=function(e){for(var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_~.",n="",r=0;r<e;r++){n+=t[Math.floor(Math.random()*t.length)]}return n},p=function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_~.",t="";return Array.from(h().getRandomValues(new Uint8Array(43))).forEach((function(n){return t+=e[n%e.length]})),t},A=function(e){return btoa(e)},v=function(e){return Object.keys(e).filter((function(t){return void 0!==e[t]})).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&")},w=function(e){return decodeURIComponent((t=e,atob(t)).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""));var t},y=function(e){return w(e.replace(/_/g,"/").replace(/-/g,"+"))},b=function(e){return new Promise((function(t){return setTimeout(t,e)}))},x=function(){function e(){this.waiters=void 0,this.acquiredIatSet=new Set,this.id=Date.now().toString()+f(15),void 0===this.waiters&&(this.waiters=[])}return e.prototype.acquireLock=function(e,t){return void 0===t&&(t=5e3),i(this,void 0,void 0,(function(){var n,r,o,i,a;return s(this,(function(s){switch(s.label){case 0:n=Date.now()+f(4),r=Date.now()+t,o="".concat("auth0-web-extension-lock-key","::").concat(e),s.label=1;case 1:return Date.now()<r?[4,b(30)]:[3,11];case 2:return s.sent(),[4,this.hasKey(o)];case 3:return s.sent()?[4,this.lockCorrector()]:[3,6];case 4:return s.sent(),[4,this.waitForSomethingToChange(r)];case 5:return s.sent(),[3,10];case 6:return[4,this.setItem(o,JSON.stringify({id:this.id,iat:n,timeUpdated:Date.now()}))];case 7:return s.sent(),[4,b(30)];case 8:return s.sent(),[4,this.getItem(o)];case 9:if(null!==(i=s.sent())&&(a=JSON.parse(i)).id===this.id&&a.iat===n)return this.acquiredIatSet.add(n),this.refreshLock(e,n),[2,!0];s.label=10;case 10:return n=Date.now()+f(4),[3,1];case 11:return[2,!1]}}))}))},e.prototype.releaseLock=function(e){return i(this,void 0,void 0,(function(){var t,n,r;return s(this,(function(o){switch(o.label){case 0:return t="".concat("auth0-web-extension-lock-key","::").concat(e),[4,this.getItem(t)];case 1:return null===(n=o.sent())?[2]:(r=JSON.parse(n)).id!==this.id?[3,4]:[4,m().lock(r.iat)];case 2:return o.sent(),this.acquiredIatSet.delete(r.iat),[4,this.removeItem(t)];case 3:o.sent(),m().unlock(r.iat),this.notifyWaiters(),o.label=4;case 4:return[2]}}))}))},e.prototype.refreshLock=function(e,t){return i(this,void 0,void 0,(function(){var n=this;return s(this,(function(r){return setTimeout((function(){return i(n,void 0,void 0,(function(){var n,r;return s(this,(function(o){switch(o.label){case 0:return[4,m().lock(t)];case 1:return o.sent(),this.acquiredIatSet.has(t)?[4,this.getItem(e)]:(m().unlock(t),[2]);case 2:return null===(n=o.sent())?[3,4]:((r=JSON.parse(n)).timeUpdated=Date.now(),[4,this.setItem(e,JSON.stringify(r))]);case 3:return o.sent(),m().unlock(t),[3,5];case 4:return m().unlock(t),[2];case 5:return this.refreshLock(e,t),[2]}}))}))}),1e3),[2]}))}))},e.prototype.lockCorrector=function(){var e,t;return i(this,void 0,void 0,(function(){var n,r,o,i,a,u,l,d;return s(this,(function(s){switch(s.label){case 0:return n=Date.now()-5e3,[4,this.allKeys()];case 1:r=s.sent(),o=!1,s.label=2;case 2:s.trys.push([2,8,9,14]),i=c(r),s.label=3;case 3:return[4,i.next()];case 4:return(a=s.sent()).done?[3,7]:(u=a.value).includes("auth0-web-extension-lock-key")?[4,this.getItem(u)]:[3,6];case 5:null!==(l=s.sent())&&JSON.parse(l).timeUpdated<n&&(this.removeItem(u),o=!0),s.label=6;case 6:return[3,3];case 7:return[3,14];case 8:return d=s.sent(),e={error:d},[3,14];case 9:return s.trys.push([9,,12,13]),a&&!a.done&&(t=i.return)?[4,t.call(i)]:[3,11];case 10:s.sent(),s.label=11;case 11:return[3,13];case 12:if(e)throw e.error;return[7];case 13:return[7];case 14:return o&&this.notifyWaiters(),[2]}}))}))},e.prototype.waitForSomethingToChange=function(e){return i(this,void 0,void 0,(function(){var t=this;return s(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(n){var r=!1,o=Date.now(),i=!1,s=function(){if(i||(l.storage.onChanged.removeListener(s),t.removeFromWaiting(s),clearTimeout(a),i=!0),!r){r=!0;var e=50-(Date.now()-o);e>0?setTimeout(n,e):n()}};l.storage.onChanged.addListener(s),t.addToWaiting(s);var a=setTimeout(s,Math.max(0,e-Date.now()))}))];case 1:return n.sent(),[2]}}))}))},e.prototype.addToWaiting=function(e){this.removeFromWaiting(e),void 0!==this.waiters&&this.waiters.push(e)},e.prototype.removeFromWaiting=function(e){void 0!==this.waiters&&(this.waiters=this.waiters.filter((function(t){return t!==e})))},e.prototype.notifyWaiters=function(){void 0!==this.waiters&&function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}([],this.waiters,!0).forEach((function(e){return e()}))},e.prototype.allKeys=function(){return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return[4,l.storage.local.get(null)];case 1:return e=t.sent(),[2,Object.keys(e)]}}))}))},e.prototype.hasKey=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return[4,l.storage.local.get(e)];case 1:return t=n.sent(),[2,Boolean(null==t?void 0:t[e])]}}))}))},e.prototype.setItem=function(e,t){return i(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return[4,l.storage.local.set((n={},n[e]=t,n))];case 1:return[2,r.sent()]}}))}))},e.prototype.getItem=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return[4,l.storage.local.get(e)];case 1:return[2,(null==(t=n.sent())?void 0:t[e])||null]}}))}))},e.prototype.removeItem=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,l.storage.local.remove(e)];case 1:return[2,t.sent()]}}))}))},e}();var k=["login_required","consent_required","interaction_required","account_selection_required","access_denied"],_=function(){return Date.now()},T=function(e){function t(n,r){var o=e.call(this,r)||this;return o.error=n,o.error_description=r,Object.setPrototypeOf(o,t.prototype),o}return n(t,e),t.fromPayload=function(e){return new t(e.error,e.error_description)},t}(Error),C=function(e){function t(n,r,o,i){void 0===i&&(i=null);var s=e.call(this,n,r)||this;return s.state=o,s.appState=i,Object.setPrototypeOf(s,t.prototype),s}return n(t,e),t}(T),S=function(e){function t(){var n=e.call(this,"timeout","Timeout")||this;return Object.setPrototypeOf(n,t.prototype),n}return n(t,e),t}(T),E=function(e){function t(n,r,o){var i=e.call(this,n,r)||this;return i.mfa_token=o,Object.setPrototypeOf(i,t.prototype),i}return n(t,e),t}(T),I=function(e,t){return i(void 0,void 0,void 0,(function(){var n,r;return s(this,(function(o){switch(o.label){case 0:return[4,(i=e,s=t,s=s||{},new Promise((function(e,t){var n=new XMLHttpRequest,r=[],o=[],a={},c=function(){return{ok:2==(n.status/100|0),statusText:n.statusText,status:n.status,url:n.responseURL,text:function(){return Promise.resolve(n.responseText)},json:function(){return Promise.resolve(n.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([n.response]))},clone:c,headers:{keys:function(){return r},entries:function(){return o},get:function(e){return a[e.toLowerCase()]},has:function(e){return e.toLowerCase()in a}}}};for(var u in n.open(s.method||"get",i,!0),n.onload=function(){n.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(e,t,n){r.push(t=t.toLowerCase()),o.push([t,n]),a[t]=a[t]?a[t]+","+n:n})),e(c())},n.onerror=t,n.withCredentials="include"==s.credentials,s.headers)n.setRequestHeader(u,s.headers[u]);n.send(s.body||null)})))];case 1:return n=o.sent(),r={ok:n.ok},[4,n.json()];case 2:return[2,(r.json=o.sent(),r)]}var i,s}))}))},P=function(e,t,n){return void 0===n&&(n=1e4),i(void 0,void 0,void 0,(function(){var r,o;return s(this,(function(i){return r=new AbortController,t.signal=r.signal,[2,Promise.race([I(e,t),new Promise((function(e,t){o=setTimeout((function(){r.abort(),t(new Error("Timeout when executing 'fetch'"))}),n)}))]).finally((function(){clearTimeout(o)}))]}))}))};function O(e,t,n){return i(this,void 0,void 0,(function(){var r,i,a,c,u,l,d,m,h;return s(this,(function(s){switch(s.label){case 0:r=null,a=0,s.label=1;case 1:if(!(a<3))return[3,6];s.label=2;case 2:return s.trys.push([2,4,,5]),[4,P(e,t,n)];case 3:return i=s.sent(),r=null,[3,6];case 4:return c=s.sent(),r=c,[3,5];case 5:return a++,[3,1];case 6:if(r)throw r.message=r.message||"Failed to fetch",r;if(u=i.json,l=u.error,d=u.error_description,m=o(u,["error","error_description"]),!i.ok){if(h=d||"HTTP error. Unable to fetch ".concat(e),"mfa_required"===l)throw new E(l,h,m.mfa_token);throw new T(l||"request_error",h)}return[2,m]}}))}))}function L(e){var t=e.baseUrl,n=e.timeout;e.audience,e.scope;var r=e.useFormData,a=o(e,["baseUrl","timeout","audience","scope","useFormData"]);return i(this,void 0,void 0,(function(){var e;return s(this,(function(o){switch(o.label){case 0:return e=r?v(a):JSON.stringify(a),[4,O("".concat(t,"/oauth/token"),{method:"POST",body:e,headers:{"Content-Type":r?"application/x-www-form-urlencoded":"application/json"}},n)];case 1:return[2,o.sent()]}}))}))}var D,j=function(e){return"number"==typeof e},U=["iss","aud","exp","nbf","iat","jti","azp","nonce","auth_time","at_hash","c_hash","acr","amr","sub_jwk","cnf","sip_from_tag","sip_date","sip_callid","sip_cseq_num","sip_via_branch","orig","dest","mky","events","toe","txn","rph","sid","vot","vtm"],M=function(e){if(!e.id_token)throw new Error("ID token is required but missing");var t=function(e){var t=e.split("."),n=t[0],r=t[1],o=t[2];if(3!==t.length||!n||!r||!o)throw new Error("ID token could not be decoded");var i=JSON.parse(y(r)),s={__raw:e},a={};return Object.keys(i).forEach((function(e){s[e]=i[e],U.includes(e)||(a[e]=i[e])})),{encoded:{header:n,payload:r,signature:o},header:JSON.parse(y(n)),claims:s,user:a}}(e.id_token);if(!t.claims.iss)throw new Error("Issuer (iss) claim must be a string present in the ID token");if(t.claims.iss!==e.iss)throw new Error('Issuer (iss) claim mismatch in the ID token; expected "'.concat(e.iss,'", found "').concat(t.claims.iss,'"'));if(!t.user.sub)throw new Error("Subject (sub) claim must be a string present in the ID token");if("RS256"!==t.header.alg)throw new Error('Signature algorithm of "'.concat(t.header.alg,'" is not supported. Expected the ID token to be signed with "RS256".'));if(!t.claims.aud||"string"!=typeof t.claims.aud&&!Array.isArray(t.claims.aud))throw new Error("Audience (aud) claim must be a string or array of strings present in the ID token");if(Array.isArray(t.claims.aud)){if(!t.claims.aud.includes(e.aud))throw new Error('Audience (aud) claim mismatch in the ID token; expected "'.concat(e.aud,'" but was not one of "').concat(t.claims.aud.join(", "),'"'));if(t.claims.aud.length>1){if(!t.claims.azp)throw new Error("Authorized Party (azp) claim must be a string present in the ID token when Audience (aud) claim has multiple values");if(t.claims.azp!==e.aud)throw new Error('Authorized Party (azp) claim mismatch in the ID token; expected "'.concat(e.aud,'", found "').concat(t.claims.azp,'"'))}}else if(t.claims.aud!==e.aud)throw new Error('Audience (aud) claim mismatch in the ID token; expected "'.concat(e.aud,'" but found "').concat(t.claims.aud,'"'));if(e.nonce){if(!t.claims.nonce)throw new Error("Nonce (nonce) claim must be a string present in the ID token");if(t.claims.nonce!==e.nonce)throw new Error('Nonce (nonce) claim mismatch in the ID token; expected "'.concat(e.nonce,'", found "').concat(t.claims.nonce,'"'))}if(e.max_age&&!j(t.claims.auth_time))throw new Error("Authentication Time (auth_time) claim must be a number present in the ID token when Max Age (max_age) is specified");if(!j(t.claims.exp))throw new Error("Expiration Time (exp) claim must be a number present in the ID token");if(!j(t.claims.iat))throw new Error("Issued At (iat) claim must be a number present in the ID token");var n=e.leeway||60,r=new Date(e.now||Date.now()),o=new Date(0),i=new Date(0),s=new Date(0);if(s.setUTCSeconds(parseInt(t.claims.auth_time)+e.max_age+n),o.setUTCSeconds(t.claims.exp+n),i.setUTCSeconds(t.claims.nbf-n),r>o)throw new Error("Expiration Time (exp) claim error in the ID token; current time (".concat(r,") is after expiration time (").concat(o,")"));if(j(t.claims.nbf)&&r<i)throw new Error("Not Before time (nbf) claim in the ID token indicates that this token can't be used just yet. Currrent time (".concat(r,") is before ").concat(i));if(j(t.claims.auth_time)&&r>s)throw new Error("Authentication Time (auth_time) claim in the ID token indicates that too much time has passed since the last end-user authentication. Currrent time (".concat(r,") is after last auth at ").concat(s));if(e.organizationId){if(!t.claims.org_id)throw new Error("Organization ID (org_id) claim must be a string present in the ID token");if(e.organizationId!==t.claims.org_id)throw new Error('Organization ID (org_id) claim mismatch in the ID token; expected "'.concat(e.organizationId,'", found "').concat(t.claims.org_id,'"'))}return t},F=function(e){return Array.from(new Set(e))},R=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return F(e.filter(Boolean).join(" ").trim().split(/\s+/)).join(" ")},z=function(){var e;this.enclosedCache=(e={},{set:function(t,n){e[t]=n},get:function(t){var n=e[t];return n||null},remove:function(t){delete e[t]},allKeys:function(){return Object.keys(e)}})},K=function(){function e(e,t){void 0===t&&(t="@@auth0webext@@"),this.prefix=t,this.client_id=e.client_id,this.scope=e.scope,this.audience=e.audience}return e.prototype.toKey=function(){return"".concat(this.prefix,"::").concat(this.client_id,"::").concat(this.audience,"::").concat(this.scope)},e.fromKey=function(t){var n=t.split("::"),r=n[0],o=n[1],i=n[2],s=n[3];return r&&o&&s&&i?new e({client_id:o,scope:s,audience:i},r):null},e.fromCacheEntry=function(t){return new e({scope:t.scope,audience:t.audience,client_id:t.client_id})},e}(),N=function(){function e(e,t,n){this.cache=e,t&&(this.keyManifest=t),this.nowProvider=n||_}return e.prototype.get=function(e,t){var n;return void 0===t&&(t=0),i(this,void 0,void 0,(function(){var r,o,i,a,c;return s(this,(function(s){switch(s.label){case 0:return[4,this.cache.get(e.toKey())];case 1:return(r=s.sent())?[3,4]:[4,this.getCacheKeys()];case 2:return(o=s.sent())&&(i=this.matchExistingCacheKey(e,o))?[4,this.cache.get(i)]:[2];case 3:r=s.sent(),s.label=4;case 4:return r?[4,this.nowProvider()]:[2];case 5:return a=s.sent(),c=Math.floor(a/1e3),r.expiresAt-t<c?r.body.refresh_token?(r.body={refresh_token:r.body.refresh_token},[4,this.cache.set(e.toKey(),r)]):[3,7]:[3,10];case 6:return s.sent(),[2,r.body];case 7:return[4,this.cache.remove(e.toKey())];case 8:return s.sent(),[4,null===(n=this.keyManifest)||void 0===n?void 0:n.remove(e.toKey())];case 9:return s.sent(),[2];case 10:return[2,r.body]}}))}))},e.prototype.set=function(e){var t;return i(this,void 0,void 0,(function(){var n,r;return s(this,(function(o){switch(o.label){case 0:return n=new K({client_id:e.client_id,scope:e.scope,audience:e.audience}),[4,this.wrapCacheEntry(e)];case 1:return r=o.sent(),[4,this.cache.set(n.toKey(),r)];case 2:return o.sent(),[4,null===(t=this.keyManifest)||void 0===t?void 0:t.add(n.toKey())];case 3:return o.sent(),[2]}}))}))},e.prototype.clear=function(e){var t;return i(this,void 0,void 0,(function(){var n,r=this;return s(this,(function(o){switch(o.label){case 0:return[4,this.getCacheKeys()];case 1:return(n=o.sent())?[4,n.filter((function(t){return!e||t.includes(e)})).reduce((function(e,t){return i(r,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,e];case 1:return n.sent(),[4,this.cache.remove(t)];case 2:return n.sent(),[2]}}))}))}),Promise.resolve())]:[2];case 2:return o.sent(),[4,null===(t=this.keyManifest)||void 0===t?void 0:t.clear()];case 3:return o.sent(),[2]}}))}))},e.prototype.clearSync=function(e){var t,n,r=this,o=null===(n=(t=this.cache).allKeys)||void 0===n?void 0:n.call(t);o&&o.filter((function(t){return!e||t.includes(e)})).forEach((function(e){r.cache.remove(e)}))},e.prototype.wrapCacheEntry=function(e){return i(this,void 0,void 0,(function(){var t,n,r;return s(this,(function(o){switch(o.label){case 0:return[4,this.nowProvider()];case 1:return t=o.sent(),n=Math.floor(t/1e3)+e.expires_in,r=Math.min(n,e.decodedToken.claims.exp||1/0),[2,{body:e,expiresAt:r}]}}))}))},e.prototype.getCacheKeys=function(){var e,t;return i(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return this.keyManifest?[4,this.keyManifest.get()]:[3,2];case 1:return[2,(n.sent()||{}).keys||[]];case 2:return[4,null===(t=(e=this.cache).allKeys)||void 0===t?void 0:t.call(e)];case 3:return[2,n.sent()||[]]}}))}))},e.prototype.matchExistingCacheKey=function(e,t){return t.filter((function(t){var n=K.fromKey(t),r=new Set((null==n?void 0:n.scope)&&n.scope.split(" ")),o=e.scope.split(" "),i=(null==n?void 0:n.scope)&&o.reduce((function(e,t){return e&&r.has(t)}),!0);return"@@auth0webext@@"===(null==n?void 0:n.prefix)&&n.client_id===e.client_id&&n.audience===e.audience&&i}))[0]},e}(),q=function(){function e(e,t){this.cache=e,this.clientId=t,this.manifestKey=this.createManifestKeyFrom(this.clientId)}return e.prototype.add=function(e){var t;return i(this,void 0,void 0,(function(){var n,r;return s(this,(function(o){switch(o.label){case 0:return r=Set.bind,[4,this.cache.get(this.manifestKey)];case 1:return(n=new(r.apply(Set,[void 0,(null===(t=o.sent())||void 0===t?void 0:t.keys)||[]]))).add(e),[4,this.cache.set(this.manifestKey,{keys:Array.from(n.values())})];case 2:return o.sent(),[2]}}))}))},e.prototype.remove=function(e){return i(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return[4,this.cache.get(this.manifestKey)];case 1:return(t=r.sent())?((n=new Set(t.keys)).delete(e),n.size>0?[4,this.cache.set(this.manifestKey,{keys:Array.from(n.values())})]:[3,3]):[3,5];case 2:case 4:return[2,r.sent()];case 3:return[4,this.cache.remove(this.manifestKey)];case 5:return[2]}}))}))},e.prototype.get=function(){return this.cache.get(this.manifestKey)},e.prototype.clear=function(){return this.cache.remove(this.manifestKey)},e.prototype.createManifestKeyFrom=function(e){return"".concat("@@auth0webext@@","::").concat(e)},e}(),B={},W=function(e,t){return void 0===t&&(t=3),i(void 0,void 0,void 0,(function(){var n,r;return s(this,(function(o){switch(o.label){case 0:n=0,o.label=1;case 1:if(!(n<t))return[3,6];o.label=2;case 2:return o.trys.push([2,4,,5]),[4,e()];case 3:return[2,o.sent()];case 4:return r=o.sent(),console.log("error: "+r),[3,5];case 5:return n++,[3,1];case 6:return[2,null]}}))}))},$=new x,J=function(){function e(e){var t,n,r;if(this.options=e,function(){if(!h())throw new Error("For security reasons, `window.crypto` is required to run `auth0-web-extension`.");if(void 0===g())throw new Error("\n      auth0-web-extension must run on a secure origin.\n    ")}(),e.cache&&e.cacheLocation&&console.warn("Both `cache` and `cacheLocation` options have been specified in the Auth0Client configuration; ignoring `cacheLocation` and using `cache`."),e.cache)r=e.cache,this.cacheLocation="memory";else{this.cacheLocation=e.cacheLocation||"memory";var o=G(this.cacheLocation);if(!o)throw new Error('Invalid cache location "'.concat(this.cacheLocation,'"'));r=o()}this.scope=this.options.scope,this.nowProvider=this.options.nowProvider||_,this.cacheManager=new N(r,r.allKeys?null:new q(r,this.options.client_id),this.nowProvider),this.domainUrl=Z(this.options.domain),this.tokenIssuer=X(this.options.issuer,this.domainUrl),this.defaultScope=R("openid",void 0!==(null===(n=null===(t=this.options)||void 0===t?void 0:t.advancedOptions)||void 0===n?void 0:n.defaultScope)?this.options.advancedOptions.defaultScope:"openid profile email"),this.options.useRefreshTokens,this.customOptions=Q(e)}return e.prototype._url=function(e){return"".concat(this.domainUrl).concat(e)},e.prototype._getParams=function(e,t,n,i,s){var a=this.options;a.useRefreshTokens,a.useCookiesForTransactions,a.useFormData,a.auth0Client,a.cacheLocation,a.advancedOptions,a.detailedResponse,a.nowProvider,a.authorizeTimeoutInSeconds,a.legacySameSiteCookie,a.sessionCheckExpiryDays,a.domain,a.leeway;var c=o(a,["useRefreshTokens","useCookiesForTransactions","useFormData","auth0Client","cacheLocation","advancedOptions","detailedResponse","nowProvider","authorizeTimeoutInSeconds","legacySameSiteCookie","sessionCheckExpiryDays","domain","leeway"]);return r(r(r({},c),e),{scope:R(this.defaultScope,this.scope,e.scope),response_type:"code",response_mode:"query",state:t,nonce:n,redirect_uri:s||this.options.redirect_uri,code_challenge:i,code_challenge_method:"S256"})},e.prototype._authorizeUrl=function(e){return this._url("/authorize?".concat(v(e)))},e.prototype.getUser=function(e){var t;return void 0===e&&(e={}),i(this,void 0,void 0,(function(){var n,r,o;return s(this,(function(i){switch(i.label){case 0:return n=e.audience||this.options.audience||"default",r=R(this.defaultScope,this.scope,e.scope),[4,this.checkSession({audience:n,scope:r})];case 1:return i.sent(),[4,this.cacheManager.get(new K({client_id:this.options.client_id,audience:n,scope:r}))];case 2:return o=i.sent(),[2,null===(t=null==o?void 0:o.decodedToken)||void 0===t?void 0:t.user]}}))}))},e.prototype.getIdTokenClaims=function(e){var t;return void 0===e&&(e={}),i(this,void 0,void 0,(function(){var n,r,o;return s(this,(function(i){switch(i.label){case 0:return n=e.audience||this.options.audience||"default",r=R(this.defaultScope,this.scope,e.scope),[4,this.checkSession({audience:n,scope:r})];case 1:return i.sent(),[4,this.cacheManager.get(new K({client_id:this.options.client_id,audience:n,scope:r}))];case 2:return o=i.sent(),[2,null===(t=null==o?void 0:o.decodedToken)||void 0===t?void 0:t.claims]}}))}))},e.prototype.isAuthenticated=function(){return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return[4,this.getUser()];case 1:return e=t.sent(),[2,Boolean(e)]}}))}))},e.prototype.checkSession=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.getTokenSilently(e)];case 1:return n.sent(),[3,3];case 2:if(t=n.sent(),!k.includes(t.error))throw t;return[3,3];case 3:return[2]}}))}))},e.prototype.getTokenSilently=function(e){return void 0===e&&(e={}),i(this,void 0,void 0,(function(){var t=this;return s(this,(function(n){return[2,(o=function(){return t._getTokenSilently(r(r({audience:t.options.audience,ignoreCache:!1},e),{scope:R(t.defaultScope,t.scope,e.scope)}))},i="".concat(this.options.client_id,"::").concat(this.options.audience,"::").concat(R(this.defaultScope,this.scope,e.scope)),s=B[i],s||(s=o().finally((function(){delete B[i],s=void 0})),B[i]=s),s)];var o,i,s}))}))},e.prototype._getTokenSilently=function(e){return void 0===e&&(e={}),i(this,void 0,void 0,(function(){var t,n,i,a,c,u,l,d,m;return s(this,(function(s){switch(s.label){case 0:return t=e.ignoreCache,n=o(e,["ignoreCache"]),t||!n.scope?[3,2]:[4,this._getEntryFromCache({scope:n.scope,audience:n.audience||"default",client_id:this.options.client_id,getDetailedEntry:e.detailedResponse})];case 1:if(i=s.sent())return[2,i];s.label=2;case 2:return[4,W((function(){return $.acquireLock("auth0.lock.getTokenSilently",5e3)}),10)];case 3:if(!s.sent())return[3,15];s.label=4;case 4:return s.trys.push([4,,12,14]),t||!n.scope?[3,6]:[4,this._getEntryFromCache({scope:n.scope,audience:n.audience||"default",client_id:this.options.client_id,getDetailedEntry:e.detailedResponse})];case 5:if(i=s.sent())return[2,i];s.label=6;case 6:return this.options.useRefreshTokens?[4,this._getTokenUsingRefreshToken(n)]:[3,8];case 7:return c=s.sent(),[3,10];case 8:return[4,this._getTokenFromIfFrame(n)];case 9:c=s.sent(),s.label=10;case 10:return a=c,[4,this.cacheManager.set(r({client_id:this.options.client_id},a))];case 11:return s.sent(),e.detailedResponse?(u=a.id_token,l=a.access_token,d=a.oauthTokenScope,m=a.expires_in,[2,r(r({id_token:u,access_token:l},d?{scope:d}:null),{expires_in:m})]):[2,a.access_token];case 12:return[4,$.releaseLock("auth0.lock.getTokenSilently")];case 13:return s.sent(),[7];case 14:return[3,16];case 15:throw new S;case 16:return[2]}}))}))},e.prototype._getTokenUsingRefreshToken=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(e){throw"We currently don't support using refresh tokens, set useRefreshTokens to false"}))}))},e.prototype._getTokenFromIfFrame=function(e){return i(this,void 0,void 0,(function(){var t,n,a,c,u,d,m,h,f,v,w,y,b,x,k,_=this;return s(this,(function(T){switch(T.label){case 0:return t=A(p()),n=A(p()),a=p(),[4,(S=a,i(void 0,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:return e=g().digest({name:"SHA-256"},(new TextEncoder).encode(S)),window&&(null===(t=window)||void 0===t?void 0:t.msCrypto)?[2,new Promise((function(t,n){e.oncomplete=function(e){t(e.target.result)},e.onerror=function(e){n(e.error)},e.onabort=function(){n("The digest operation was aborted")}}))]:[3,1];case 1:return[4,e];case 2:return[2,n.sent()]}}))})))];case 1:c=T.sent(),C=new Uint8Array(c),u=function(e){var t={"+":"-","/":"_","=":""};return e.replace(/[+/=]/g,(function(e){return t[e]}))}(A(String.fromCharCode.apply(String,Array.from(C)))),d=this._getParams(e,t,n,u,e.redirect_uri||this.options.redirect_uri),m=this._authorizeUrl(r(r({},d),{prompt:"none",response_mode:"web_message"})),e.timeoutInSeconds||this.options.authorizeTimeoutInSeconds,T.label=2;case 2:return T.trys.push([2,7,,8]),console.log("acquiring tab id"),[4,W(this._getTabId,10)];case 3:if(!(h=T.sent()))throw"Failed to connect to tab too many times";return console.log("content script running on "+h),[4,new Promise((function(e){console.log("connecting to ");var t=l.tabs.connect(h,{name:"auth0-web-extension::parent"}),n=function(r){"auth0-web-extension::child"===r.name&&(console.log("adding child port listener"),r.onMessage.addListener((function(o){e(o),console.log("received message from child "+o),r.disconnect(),t.disconnect(),l.runtime.onConnect.removeListener(n)})),console.log("sending authorize parameters "),r.postMessage({authorizeUrl:m,domainUrl:_.domainUrl}))};l.runtime.onConnect.addListener(n),t.postMessage({redirectUri:d.redirect_uri})}))];case 4:if(f=T.sent(),t!==f.state)throw new Error("Invalid state");return v=e.scope,w=e.audience,y=o(e,["scope","redirect_uri","audience","ignoreCache","timeoutInSeconds","detailedResponse"]),[4,L(r(r(r({},this.customOptions),y),{scope:v,audience:w,baseUrl:this.domainUrl,client_id:this.options.client_id,code_verifier:a,code:f.code,grant_type:"authorization_code",redirect_uri:d.redirect_uri,useFormData:this.options.useFormData,auth0Client:{}}))];case 5:return b=T.sent(),[4,this._verifyIdToken(b.id_token,n)];case 6:return x=T.sent(),[2,r(r({},b),{decodedToken:x,scope:d.scope,oauthTokenScope:b.scope,audience:d.audience||"default"})];case 7:throw(k=T.sent()).error,k;case 8:return[2]}var C,S}))}))},e.prototype._getTabId=function(){return i(this,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(o){switch(o.label){case 0:return e={active:!0,currentWindow:!0},[4,l.tabs.query(e)];case 1:return t=o.sent()[0],console.log("currentTab "+t),(n=(t||{}).id)?[4,l.tabs.sendMessage(n,"")]:[3,3];case 2:if(r=o.sent(),console.log(r),"ack"===r)return[2,n];o.label=3;case 3:throw"Could not access current tab."}}))}))},e.prototype._verifyIdToken=function(e,t,n){return i(this,void 0,void 0,(function(){var r;return s(this,(function(o){switch(o.label){case 0:return[4,this.nowProvider()];case 1:return r=o.sent(),[2,M({iss:this.tokenIssuer,aud:this.options.client_id,id_token:e,nonce:t,organizationId:n,leeway:this.options.leeway,max_age:H(this.options.max_age),now:r})]}}))}))},e.prototype._getEntryFromCache=function(e){var t=e.scope,n=e.audience,o=e.client_id,a=e.getDetailedEntry,c=void 0!==a&&a;return i(this,void 0,void 0,(function(){var e,i,a,u,l;return s(this,(function(s){switch(s.label){case 0:return[4,this.cacheManager.get(new K({scope:t,audience:n,client_id:o}),60)];case 1:return(e=s.sent())&&e.access_token?c?(i=e.id_token,a=e.access_token,u=e.oauthTokenScope,l=e.expires_in,i&&l?[2,r(r({id_token:i,access_token:a},u?{scope:u}:null),{expires_in:l})]:[2,void 0]):[2,e.access_token]:[2]}}))}))},e}(),H=function(e){return"string"!=typeof e?e:parseInt(e,10)||void 0},Z=function(e){return/^https?:\/\//.test(e)?e:"https://".concat(e)},V=((D={}).memory=function(){return(new z).enclosedCache},D),G=function(e){return V[e]},X=function(e,t){return e?e.startsWith("https://")?e:"https://".concat(e,"/"):"".concat(t,"/")},Q=function(e){return e.advancedOptions,e.audience,e.auth0Client,e.authorizeTimeoutInSeconds,e.cacheLocation,e.client_id,e.domain,e.issuer,e.leeway,e.max_age,e.redirect_uri,e.scope,e.useRefreshTokens,e.useCookiesForTransactions,e.useFormData,o(e,["advancedOptions","audience","auth0Client","authorizeTimeoutInSeconds","cacheLocation","client_id","domain","issuer","leeway","max_age","redirect_uri","scope","useRefreshTokens","useCookiesForTransactions","useFormData"])},Y=function(){};function ee(e){var t=this;if(l.runtime.onMessage.addListener((function(){return Promise.resolve("ack")})),console.log(window.location.origin),window.location.origin===e){l.runtime.connect(void 0,{name:"auth0-web-extension::child"}).onMessage.addListener((function(e,n){return i(t,void 0,void 0,(function(){var t,r,o;return s(this,(function(i){switch(i.label){case 0:return"auth0-web-extension::child"!==n.name?[3,2]:(t=e.authorizeUrl,r=e.domainUrl,[4,te(t,r,60)]);case 1:o=i.sent(),n.postMessage(o),i.label=2;case 2:return[2]}}))}))}))}else l.runtime.onConnect.addListener((function(t){if("auth0-web-extension::parent"===t.name){var n=function(){var r=document.createElement("iframe");r.setAttribute("width","0"),r.setAttribute("height","0"),r.style.display="none",document.body.appendChild(r),r.setAttribute("src",e),t.onMessage.removeListener(n),t.onDisconnect.addListener((function(){window.document.body.removeChild(r)}))};t.onMessage.addListener(n)}}))}var te=function(e,t,n){return void 0===n&&(n=60),i(void 0,void 0,void 0,(function(){return s(this,(function(r){return[2,new Promise((function(r,o){var i=window.document.createElement("iframe");i.setAttribute("width","0"),i.setAttribute("height","0"),i.style.display="none";var s,a=function(){window.document.body.contains(i)&&(window.document.body.removeChild(i),window.removeEventListener("message",s,!1))},c=setTimeout((function(){o(new S),a()}),1e3*n);s=function(e){if(console.log(e),e.origin==t&&e.data&&"authorization_response"===e.data.type){var n=e.source;n&&n.close(),e.data.response.error?o(T.fromPayload(e.data.response)):r(e.data.response),clearTimeout(c),window.removeEventListener("message",s,!1),setTimeout(a,2e3)}},window.addEventListener("message",s,!1),window.document.body.appendChild(i),i.setAttribute("src",e)}))]}))}))};function ne(e){return new J(e)}export{J as Auth0Client,C as AuthenticationError,T as GenericError,E as MfaRequiredError,S as TimeoutError,Y as User,ne as default,ee as handleTokenRequest};
//# sourceMappingURL=auth0-web-extension.production.esm.js.map
