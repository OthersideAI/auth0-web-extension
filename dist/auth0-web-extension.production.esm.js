/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)};function r(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}function o(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function i(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function s(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function a(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=s(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,o,(t=e[n](t)).done,t.value)}))}}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var c={exports:{}};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,function(e){if("undefined"==typeof browser||Object.getPrototypeOf(browser)!==Object.prototype){const t="The message port closed before a response was received.",n="Returning a Promise is the preferred way to send a reply from an onMessage/onMessageExternal listener, as the sendResponse will be removed from the specs (See https://developer.mozilla.org/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage)",r=e=>{const r={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(r).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class o extends WeakMap{constructor(e,t){super(t),this.createItem=e}get(e){return this.has(e)||this.set(e,this.createItem(e)),super.get(e)}}const i=e=>e&&"object"==typeof e&&"function"==typeof e.then,s=(t,n)=>(...r)=>{e.runtime.lastError?t.reject(new Error(e.runtime.lastError.message)):n.singleCallbackArg||r.length<=1&&!1!==n.singleCallbackArg?t.resolve(r[0]):t.resolve(r)},a=e=>1==e?"argument":"arguments",c=(e,t)=>function(n,...r){if(r.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${a(t.minArgs)} for ${e}(), got ${r.length}`);if(r.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${a(t.maxArgs)} for ${e}(), got ${r.length}`);return new Promise(((o,i)=>{if(t.fallbackToNoCallback)try{n[e](...r,s({resolve:o,reject:i},t))}catch(i){console.warn(`${e} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,i),n[e](...r),t.fallbackToNoCallback=!1,t.noCallback=!0,o()}else t.noCallback?(n[e](...r),o()):n[e](...r,s({resolve:o,reject:i},t))}))},u=(e,t,n)=>new Proxy(t,{apply:(t,r,o)=>n.call(r,e,...o)});let l=Function.call.bind(Object.prototype.hasOwnProperty);const m=(e,t={},n={})=>{let r=Object.create(null),o={has:(t,n)=>n in e||n in r,get(o,i,s){if(i in r)return r[i];if(!(i in e))return;let a=e[i];if("function"==typeof a)if("function"==typeof t[i])a=u(e,e[i],t[i]);else if(l(n,i)){let t=c(i,n[i]);a=u(e,e[i],t)}else a=a.bind(e);else if("object"==typeof a&&null!==a&&(l(t,i)||l(n,i)))a=m(a,t[i],n[i]);else{if(!l(n,"*"))return Object.defineProperty(r,i,{configurable:!0,enumerable:!0,get:()=>e[i],set(t){e[i]=t}}),a;a=m(a,t[i],n["*"])}return r[i]=a,a},set:(t,n,o,i)=>(n in r?r[n]=o:e[n]=o,!0),defineProperty:(e,t,n)=>Reflect.defineProperty(r,t,n),deleteProperty:(e,t)=>Reflect.deleteProperty(r,t)},i=Object.create(e);return new Proxy(i,o)},d=e=>({addListener(t,n,...r){t.addListener(e.get(n),...r)},hasListener:(t,n)=>t.hasListener(e.get(n)),removeListener(t,n){t.removeListener(e.get(n))}}),g=new o((e=>"function"!=typeof e?e:function(t){const n=m(t,{},{getContent:{minArgs:0,maxArgs:0}});e(n)}));let h=!1;const f=new o((e=>"function"!=typeof e?e:function(t,r,o){let s,a,c=!1,u=new Promise((e=>{s=function(t){h||(console.warn(n,(new Error).stack),h=!0),c=!0,e(t)}}));try{a=e(t,r,s)}catch(e){a=Promise.reject(e)}const l=!0!==a&&i(a);if(!0!==a&&!l&&!c)return!1;const m=e=>{e.then((e=>{o(e)}),(e=>{let t;t=e&&(e instanceof Error||"string"==typeof e.message)?e.message:"An unexpected error occurred",o({__mozWebExtensionPolyfillReject__:!0,message:t})})).catch((e=>{console.error("Failed to send onMessage rejected reply",e)}))};return m(l?a:u),!0})),p=({reject:n,resolve:r},o)=>{e.runtime.lastError?e.runtime.lastError.message===t?r():n(new Error(e.runtime.lastError.message)):o&&o.__mozWebExtensionPolyfillReject__?n(new Error(o.message)):r(o)},A=(e,t,n,...r)=>{if(r.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${a(t.minArgs)} for ${e}(), got ${r.length}`);if(r.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${a(t.maxArgs)} for ${e}(), got ${r.length}`);return new Promise(((e,t)=>{const o=p.bind(null,{resolve:e,reject:t});r.push(o),n.sendMessage(...r)}))},v={devtools:{network:{onRequestFinished:d(g)}},runtime:{onMessage:d(f),onMessageExternal:d(f),sendMessage:A.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:A.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},w={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return r.privacy={network:{"*":w},services:{"*":w},websites:{"*":w}},m(e,v,r)};if("object"!=typeof chrome||!chrome||!chrome.runtime||!chrome.runtime.id)throw new Error("This script should only be loaded in a browser extension.");e.exports=r(chrome)}else e.exports=browser}(c);var u=c.exports,l=function(){function e(){var e=this;this.locked=new Map,this.addToLocked=function(t,n){var r=e.locked.get(t);void 0===r?void 0===n?e.locked.set(t,[]):e.locked.set(t,[n]):void 0!==n&&(r.unshift(n),e.locked.set(t,r))},this.isLocked=function(t){return e.locked.has(t)},this.lock=function(t){return new Promise((function(n,r){e.isLocked(t)?e.addToLocked(t,n):(e.addToLocked(t),n())}))},this.unlock=function(t){var n=e.locked.get(t);if(void 0!==n&&0!==n.length){var r=n.pop();e.locked.set(t,n),void 0!==r&&setTimeout(r,0)}else e.locked.delete(t)}}return e.getInstance=function(){return void 0===e.instance&&(e.instance=new e),e.instance},e}();function m(){return l.getInstance()}var d=function(){return crypto||window.msCrypto},g=function(){var e=d();return e.subtle||e.webkitSubtle},h=function(e){for(var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_~.",n="",r=0;r<e;r++){n+=t[Math.floor(Math.random()*t.length)]}return n},f=function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_~.",t="";return Array.from(d().getRandomValues(new Uint8Array(43))).forEach((function(n){return t+=e[n%e.length]})),t},p=function(e){return btoa(e)},A=function(e){return Object.keys(e).filter((function(t){return void 0!==e[t]})).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&")},v=function(e){return decodeURIComponent((t=e,atob(t)).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""));var t},w=function(e){return v(e.replace(/_/g,"/").replace(/-/g,"+"))},y=function(e){return new Promise((function(t){return setTimeout(t,e)}))},b=function(){function e(){this.waiters=void 0,this.acquiredIatSet=new Set,this.id=Date.now().toString()+h(15),void 0===this.waiters&&(this.waiters=[])}return e.prototype.acquireLock=function(e,t){return void 0===t&&(t=5e3),o(this,void 0,void 0,(function(){var n,r,o,s,a;return i(this,(function(i){switch(i.label){case 0:n=Date.now()+h(4),r=Date.now()+t,o="".concat("auth0-web-extension-lock-key","::").concat(e),i.label=1;case 1:return Date.now()<r?[4,y(30)]:[3,11];case 2:return i.sent(),[4,this.hasKey(o)];case 3:return i.sent()?[4,this.lockCorrector()]:[3,6];case 4:return i.sent(),[4,this.waitForSomethingToChange(r)];case 5:return i.sent(),[3,10];case 6:return[4,this.setItem(o,JSON.stringify({id:this.id,iat:n,timeUpdated:Date.now()}))];case 7:return i.sent(),[4,y(30)];case 8:return i.sent(),[4,this.getItem(o)];case 9:if(null!==(s=i.sent())&&(a=JSON.parse(s)).id===this.id&&a.iat===n)return this.acquiredIatSet.add(n),this.refreshLock(e,n),[2,!0];i.label=10;case 10:return n=Date.now()+h(4),[3,1];case 11:return[2,!1]}}))}))},e.prototype.releaseLock=function(e){return o(this,void 0,void 0,(function(){var t,n,r;return i(this,(function(o){switch(o.label){case 0:return console.log("inside releaseLock"),t="".concat("auth0-web-extension-lock-key","::").concat(e),[4,this.getItem(t)];case 1:return null===(n=o.sent())?[2]:(console.log("parsing"),(r=JSON.parse(n)).id!==this.id?[3,4]:[4,m().lock(r.iat)]);case 2:return o.sent(),this.acquiredIatSet.delete(r.iat),[4,this.removeItem(t)];case 3:o.sent(),m().unlock(r.iat),console.log("notifying waiters"),this.notifyWaiters(),o.label=4;case 4:return[2]}}))}))},e.prototype.refreshLock=function(e,t){return o(this,void 0,void 0,(function(){var n=this;return i(this,(function(r){return setTimeout((function(){return o(n,void 0,void 0,(function(){var n,r;return i(this,(function(o){switch(o.label){case 0:return[4,m().lock(t)];case 1:return o.sent(),this.acquiredIatSet.has(t)?[4,this.getItem(e)]:(m().unlock(t),[2]);case 2:return null===(n=o.sent())?[3,4]:((r=JSON.parse(n)).timeUpdated=Date.now(),[4,this.setItem(e,JSON.stringify(r))]);case 3:return o.sent(),m().unlock(t),[3,5];case 4:return m().unlock(t),[2];case 5:return this.refreshLock(e,t),[2]}}))}))}),1e3),[2]}))}))},e.prototype.lockCorrector=function(){var e,t;return o(this,void 0,void 0,(function(){var n,r,o,s,c,u,l,m;return i(this,(function(i){switch(i.label){case 0:return n=Date.now()-5e3,[4,this.allKeys()];case 1:r=i.sent(),o=!1,i.label=2;case 2:i.trys.push([2,8,9,14]),s=a(r),i.label=3;case 3:return[4,s.next()];case 4:return(c=i.sent()).done?[3,7]:(u=c.value).includes("auth0-web-extension-lock-key")?[4,this.getItem(u)]:[3,6];case 5:null!==(l=i.sent())&&JSON.parse(l).timeUpdated<n&&(this.removeItem(u),o=!0),i.label=6;case 6:return[3,3];case 7:return[3,14];case 8:return m=i.sent(),e={error:m},[3,14];case 9:return i.trys.push([9,,12,13]),c&&!c.done&&(t=s.return)?[4,t.call(s)]:[3,11];case 10:i.sent(),i.label=11;case 11:return[3,13];case 12:if(e)throw e.error;return[7];case 13:return[7];case 14:return o&&this.notifyWaiters(),[2]}}))}))},e.prototype.waitForSomethingToChange=function(e){return o(this,void 0,void 0,(function(){var t=this;return i(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(n){var r=!1,o=Date.now(),i=!1,s=function(){if(i||(u.storage.onChanged.removeListener(s),t.removeFromWaiting(s),clearTimeout(a),i=!0),!r){r=!0;var e=50-(Date.now()-o);e>0?setTimeout(n,e):n()}};u.storage.onChanged.addListener(s),t.addToWaiting(s);var a=setTimeout(s,Math.max(0,e-Date.now()))}))];case 1:return n.sent(),[2]}}))}))},e.prototype.addToWaiting=function(e){this.removeFromWaiting(e),void 0!==this.waiters&&this.waiters.push(e)},e.prototype.removeFromWaiting=function(e){void 0!==this.waiters&&(this.waiters=this.waiters.filter((function(t){return t!==e})))},e.prototype.notifyWaiters=function(){this.waiters?(console.log("resetting waiters"),function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}([],this.waiters,!0).forEach((function(e){return e()}))):console.log("no waiters")},e.prototype.allKeys=function(){return o(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return[4,u.storage.local.get(null)];case 1:return e=t.sent(),[2,Object.keys(e)]}}))}))},e.prototype.hasKey=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,u.storage.local.get(e)];case 1:return t=n.sent(),[2,Boolean(null==t?void 0:t[e])]}}))}))},e.prototype.setItem=function(e,t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,u.storage.local.set((n={},n[e]=t,n))];case 1:return[2,r.sent()]}}))}))},e.prototype.getItem=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,u.storage.local.get(e)];case 1:return[2,(null==(t=n.sent())?void 0:t[e])||null]}}))}))},e.prototype.removeItem=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,u.storage.local.remove(e)];case 1:return[2,t.sent()]}}))}))},e}(),x=["login_required","consent_required","interaction_required","account_selection_required","access_denied"],k=function(){return Date.now()},_=function(e){function n(t,r){var o=e.call(this,r)||this;return o.error=t,o.error_description=r,Object.setPrototypeOf(o,n.prototype),o}return t(n,e),n.fromPayload=function(e){return new n(e.error,e.error_description)},n}(Error),T=function(e){function n(t,r,o,i){void 0===i&&(i=null);var s=e.call(this,t,r)||this;return s.state=o,s.appState=i,Object.setPrototypeOf(s,n.prototype),s}return t(n,e),n}(_),S=function(e){function n(){var t=e.call(this,"timeout","Timeout")||this;return Object.setPrototypeOf(t,n.prototype),t}return t(n,e),n}(_),C=function(e){function n(t,r,o){var i=e.call(this,t,r)||this;return i.mfa_token=o,Object.setPrototypeOf(i,n.prototype),i}return t(n,e),n}(_),I=function(e,t){return o(void 0,void 0,void 0,(function(){var n,r;return i(this,(function(o){switch(o.label){case 0:return[4,fetch(e,t)];case 1:return n=o.sent(),r={ok:n.ok},[4,n.json()];case 2:return[2,(r.json=o.sent(),r)]}}))}))},E=function(e,t,n){return void 0===n&&(n=1e4),o(void 0,void 0,void 0,(function(){var r,o;return i(this,(function(i){return r=new AbortController,t.signal=r.signal,[2,Promise.race([I(e,t),new Promise((function(e,t){o=setTimeout((function(){r.abort(),t(new Error("Timeout when executing 'fetch'"))}),n)}))]).finally((function(){clearTimeout(o)}))]}))}))};function P(e,t,n){return o(this,void 0,void 0,(function(){var o,s,a,c,u,l,m,d,g;return i(this,(function(i){switch(i.label){case 0:o=null,a=0,i.label=1;case 1:if(!(a<3))return[3,6];i.label=2;case 2:return i.trys.push([2,4,,5]),[4,E(e,t,n)];case 3:return s=i.sent(),o=null,[3,6];case 4:return c=i.sent(),o=c,[3,5];case 5:return a++,[3,1];case 6:if(o)throw o.message=o.message||"Failed to fetch",o;if(u=s.json,l=u.error,m=u.error_description,d=r(u,["error","error_description"]),!s.ok){if(g=m||"HTTP error. Unable to fetch ".concat(e),"mfa_required"===l)throw new C(l,g,d.mfa_token);throw new _(l||"request_error",g)}return[2,d]}}))}))}function D(e){var t=e.baseUrl,n=e.timeout;e.audience,e.scope,e.auth0Client;var s=e.useFormData,a=r(e,["baseUrl","timeout","audience","scope","auth0Client","useFormData"]);return o(this,void 0,void 0,(function(){var e;return i(this,(function(r){switch(r.label){case 0:return e=s?A(a):JSON.stringify(a),[4,P("".concat(t,"/oauth/token"),{method:"POST",body:e,headers:{"Content-Type":s?"application/x-www-form-urlencoded":"application/json"}},n)];case 1:return[2,r.sent()]}}))}))}var O,j=function(e){return"number"==typeof e},L=["iss","aud","exp","nbf","iat","jti","azp","nonce","auth_time","at_hash","c_hash","acr","amr","sub_jwk","cnf","sip_from_tag","sip_date","sip_callid","sip_cseq_num","sip_via_branch","orig","dest","mky","events","toe","txn","rph","sid","vot","vtm"],M=function(e){if(!e.id_token)throw new Error("ID token is required but missing");var t=function(e){var t=e.split("."),n=t[0],r=t[1],o=t[2];if(3!==t.length||!n||!r||!o)throw new Error("ID token could not be decoded");var i=JSON.parse(w(r)),s={__raw:e},a={};return Object.keys(i).forEach((function(e){s[e]=i[e],L.includes(e)||(a[e]=i[e])})),{encoded:{header:n,payload:r,signature:o},header:JSON.parse(w(n)),claims:s,user:a}}(e.id_token);if(!t.claims.iss)throw new Error("Issuer (iss) claim must be a string present in the ID token");if(t.claims.iss!==e.iss)throw new Error('Issuer (iss) claim mismatch in the ID token; expected "'.concat(e.iss,'", found "').concat(t.claims.iss,'"'));if(!t.user.sub)throw new Error("Subject (sub) claim must be a string present in the ID token");if("RS256"!==t.header.alg)throw new Error('Signature algorithm of "'.concat(t.header.alg,'" is not supported. Expected the ID token to be signed with "RS256".'));if(!t.claims.aud||"string"!=typeof t.claims.aud&&!Array.isArray(t.claims.aud))throw new Error("Audience (aud) claim must be a string or array of strings present in the ID token");if(Array.isArray(t.claims.aud)){if(!t.claims.aud.includes(e.aud))throw new Error('Audience (aud) claim mismatch in the ID token; expected "'.concat(e.aud,'" but was not one of "').concat(t.claims.aud.join(", "),'"'));if(t.claims.aud.length>1){if(!t.claims.azp)throw new Error("Authorized Party (azp) claim must be a string present in the ID token when Audience (aud) claim has multiple values");if(t.claims.azp!==e.aud)throw new Error('Authorized Party (azp) claim mismatch in the ID token; expected "'.concat(e.aud,'", found "').concat(t.claims.azp,'"'))}}else if(t.claims.aud!==e.aud)throw new Error('Audience (aud) claim mismatch in the ID token; expected "'.concat(e.aud,'" but found "').concat(t.claims.aud,'"'));if(e.nonce){if(!t.claims.nonce)throw new Error("Nonce (nonce) claim must be a string present in the ID token");if(t.claims.nonce!==e.nonce)throw new Error('Nonce (nonce) claim mismatch in the ID token; expected "'.concat(e.nonce,'", found "').concat(t.claims.nonce,'"'))}if(e.max_age&&!j(t.claims.auth_time))throw new Error("Authentication Time (auth_time) claim must be a number present in the ID token when Max Age (max_age) is specified");if(!j(t.claims.exp))throw new Error("Expiration Time (exp) claim must be a number present in the ID token");if(!j(t.claims.iat))throw new Error("Issued At (iat) claim must be a number present in the ID token");var n=e.leeway||60,r=new Date(e.now||Date.now()),o=new Date(0),i=new Date(0),s=new Date(0);if(s.setUTCSeconds(parseInt(t.claims.auth_time)+e.max_age+n),o.setUTCSeconds(t.claims.exp+n),i.setUTCSeconds(t.claims.nbf-n),r>o)throw new Error("Expiration Time (exp) claim error in the ID token; current time (".concat(r,") is after expiration time (").concat(o,")"));if(j(t.claims.nbf)&&r<i)throw new Error("Not Before time (nbf) claim in the ID token indicates that this token can't be used just yet. Currrent time (".concat(r,") is before ").concat(i));if(j(t.claims.auth_time)&&r>s)throw new Error("Authentication Time (auth_time) claim in the ID token indicates that too much time has passed since the last end-user authentication. Currrent time (".concat(r,") is after last auth at ").concat(s));if(e.organizationId){if(!t.claims.org_id)throw new Error("Organization ID (org_id) claim must be a string present in the ID token");if(e.organizationId!==t.claims.org_id)throw new Error('Organization ID (org_id) claim mismatch in the ID token; expected "'.concat(e.organizationId,'", found "').concat(t.claims.org_id,'"'))}return t},F=function(){var e;this.enclosedCache=(e={},{set:function(t,n){e[t]=n},get:function(t){var n=e[t];return n||null},remove:function(t){delete e[t]},allKeys:function(){return Object.keys(e)}})},U=function(){function e(e,t){void 0===t&&(t="@@auth0webext@@"),this.prefix=t,this.client_id=e.client_id,this.scope=e.scope,this.audience=e.audience}return e.prototype.toKey=function(){return"".concat(this.prefix,"::").concat(this.client_id,"::").concat(this.audience,"::").concat(this.scope)},e.fromKey=function(t){var n=t.split("::"),r=n[0],o=n[1],i=n[2],s=n[3];return r&&o&&s&&i?new e({client_id:o,scope:s,audience:i},r):null},e.fromCacheEntry=function(t){return new e({scope:t.scope,audience:t.audience,client_id:t.client_id})},e}(),R=function(){function e(e,t,n){this.cache=e,t&&(this.keyManifest=t),this.nowProvider=n||k}return e.prototype.get=function(e,t){var n;return void 0===t&&(t=0),o(this,void 0,void 0,(function(){var r,o,s,a,c;return i(this,(function(i){switch(i.label){case 0:return[4,this.cache.get(e.toKey())];case 1:return(r=i.sent())?[3,4]:[4,this.getCacheKeys()];case 2:return(o=i.sent())&&(s=this.matchExistingCacheKey(e,o))?[4,this.cache.get(s)]:[2];case 3:r=i.sent(),i.label=4;case 4:return r?[4,this.nowProvider()]:[2];case 5:return a=i.sent(),c=Math.floor(a/1e3),r.expiresAt-t<c?r.body.refresh_token?(r.body={refresh_token:r.body.refresh_token},[4,this.cache.set(e.toKey(),r)]):[3,7]:[3,10];case 6:return i.sent(),[2,r.body];case 7:return[4,this.cache.remove(e.toKey())];case 8:return i.sent(),[4,null===(n=this.keyManifest)||void 0===n?void 0:n.remove(e.toKey())];case 9:return i.sent(),[2];case 10:return[2,r.body]}}))}))},e.prototype.set=function(e){var t;return o(this,void 0,void 0,(function(){var n,r;return i(this,(function(o){switch(o.label){case 0:return n=new U({client_id:e.client_id,scope:e.scope,audience:e.audience}),[4,this.wrapCacheEntry(e)];case 1:return r=o.sent(),[4,this.cache.set(n.toKey(),r)];case 2:return o.sent(),[4,null===(t=this.keyManifest)||void 0===t?void 0:t.add(n.toKey())];case 3:return o.sent(),[2]}}))}))},e.prototype.clear=function(e){var t;return o(this,void 0,void 0,(function(){var n,r=this;return i(this,(function(s){switch(s.label){case 0:return[4,this.getCacheKeys()];case 1:return(n=s.sent())?[4,n.filter((function(t){return!e||t.includes(e)})).reduce((function(e,t){return o(r,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,e];case 1:return n.sent(),[4,this.cache.remove(t)];case 2:return n.sent(),[2]}}))}))}),Promise.resolve())]:[2];case 2:return s.sent(),[4,null===(t=this.keyManifest)||void 0===t?void 0:t.clear()];case 3:return s.sent(),[2]}}))}))},e.prototype.clearSync=function(e){var t,n,r=this,o=null===(n=(t=this.cache).allKeys)||void 0===n?void 0:n.call(t);o&&o.filter((function(t){return!e||t.includes(e)})).forEach((function(e){r.cache.remove(e)}))},e.prototype.wrapCacheEntry=function(e){return o(this,void 0,void 0,(function(){var t,n,r;return i(this,(function(o){switch(o.label){case 0:return[4,this.nowProvider()];case 1:return t=o.sent(),n=Math.floor(t/1e3)+e.expires_in,r=Math.min(n,e.decodedToken.claims.exp||1/0),[2,{body:e,expiresAt:r}]}}))}))},e.prototype.getCacheKeys=function(){var e,t;return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return this.keyManifest?[4,this.keyManifest.get()]:[3,2];case 1:return[2,(n.sent()||{}).keys||[]];case 2:return[4,null===(t=(e=this.cache).allKeys)||void 0===t?void 0:t.call(e)];case 3:return[2,n.sent()||[]]}}))}))},e.prototype.matchExistingCacheKey=function(e,t){return t.filter((function(t){var n=U.fromKey(t),r=new Set((null==n?void 0:n.scope)&&n.scope.split(" ")),o=e.scope.split(" "),i=(null==n?void 0:n.scope)&&o.reduce((function(e,t){return e&&r.has(t)}),!0);return"@@auth0webext@@"===(null==n?void 0:n.prefix)&&n.client_id===e.client_id&&n.audience===e.audience&&i}))[0]},e}(),z=function(){function e(e,t){this.cache=e,this.clientId=t,this.manifestKey=this.createManifestKeyFrom(this.clientId)}return e.prototype.add=function(e){var t;return o(this,void 0,void 0,(function(){var n,r;return i(this,(function(o){switch(o.label){case 0:return r=Set.bind,[4,this.cache.get(this.manifestKey)];case 1:return(n=new(r.apply(Set,[void 0,(null===(t=o.sent())||void 0===t?void 0:t.keys)||[]]))).add(e),[4,this.cache.set(this.manifestKey,{keys:Array.from(n.values())})];case 2:return o.sent(),[2]}}))}))},e.prototype.remove=function(e){return o(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return[4,this.cache.get(this.manifestKey)];case 1:return(t=r.sent())?((n=new Set(t.keys)).delete(e),n.size>0?[4,this.cache.set(this.manifestKey,{keys:Array.from(n.values())})]:[3,3]):[3,5];case 2:case 4:return[2,r.sent()];case 3:return[4,this.cache.remove(this.manifestKey)];case 5:return[2]}}))}))},e.prototype.get=function(){return this.cache.get(this.manifestKey)},e.prototype.clear=function(){return this.cache.remove(this.manifestKey)},e.prototype.createManifestKeyFrom=function(e){return"".concat("@@auth0webext@@","::").concat(e)},e}(),K={},N=new b,q=function(){function e(e){var t,n,r;if(this.options=e,function(){if(!d())throw new Error("For security reasons, `window.crypto` is required to run `auth0-web-extension`.");if(void 0===g())throw new Error("\n      auth0-web-extension must run on a secure origin.\n    ")}(),console.log("factory started"),e.cache&&e.cacheLocation&&console.warn("Both `cache` and `cacheLocation` options have been specified in the Auth0Client configuration; ignoring `cacheLocation` and using `cache`."),e.cache)r=e.cache,this.cacheLocation="memory";else{this.cacheLocation=e.cacheLocation||"memory";var o=J(this.cacheLocation);if(!o)throw new Error('Invalid cache location "'.concat(this.cacheLocation,'"'));r=o()}console.log("103"),this.scope=this.options.scope,this.nowProvider=this.options.nowProvider||k,this.cacheManager=new R(r,r.allKeys?null:new z(r,this.options.client_id),this.nowProvider),this.domainUrl=W(this.options.domain),this.tokenIssuer=Z(this.options.issuer,this.domainUrl),console.log("119"),this.defaultScope=V("openid",(null===(n=null===(t=this.options)||void 0===t?void 0:t.advancedOptions)||void 0===n?void 0:n.defaultScope)||"openid profile email"),this.options.useRefreshTokens,this.customOptions=G(e)}return e.prototype._url=function(e){return"".concat(this.domainUrl).concat(e)},e.prototype._getParams=function(e,t,o,i,s){var a=this.options;a.useRefreshTokens,a.useCookiesForTransactions,a.useFormData,a.auth0Client,a.cacheLocation,a.advancedOptions,a.detailedResponse,a.nowProvider,a.authorizeTimeoutInSeconds,a.legacySameSiteCookie,a.sessionCheckExpiryDays,a.domain,a.leeway;var c=r(a,["useRefreshTokens","useCookiesForTransactions","useFormData","auth0Client","cacheLocation","advancedOptions","detailedResponse","nowProvider","authorizeTimeoutInSeconds","legacySameSiteCookie","sessionCheckExpiryDays","domain","leeway"]);return n(n(n({},c),e),{scope:V(this.defaultScope,this.scope,e.scope),response_type:"code",response_mode:"query",state:t,nonce:o,redirect_uri:s||this.options.redirect_uri,code_challenge:i,code_challenge_method:"S256"})},e.prototype._authorizeUrl=function(e){return this._url("/authorize?".concat(A(e)))},e.prototype.getUser=function(e){var t;return void 0===e&&(e={}),o(this,void 0,void 0,(function(){var n,r,o;return i(this,(function(i){switch(i.label){case 0:return n=e.audience||this.options.audience||"default",r=V(this.defaultScope,this.scope,e.scope),[4,this.checkSession({audience:n,scope:r})];case 1:return i.sent(),[4,this.cacheManager.get(new U({client_id:this.options.client_id,audience:n,scope:r}))];case 2:return o=i.sent(),[2,null===(t=null==o?void 0:o.decodedToken)||void 0===t?void 0:t.user]}}))}))},e.prototype.getIdTokenClaims=function(e){var t;return void 0===e&&(e={}),o(this,void 0,void 0,(function(){var n,r,o;return i(this,(function(i){switch(i.label){case 0:return n=e.audience||this.options.audience||"default",r=V(this.defaultScope,this.scope,e.scope),[4,this.checkSession({audience:n,scope:r})];case 1:return i.sent(),[4,this.cacheManager.get(new U({client_id:this.options.client_id,audience:n,scope:r}))];case 2:return o=i.sent(),[2,null===(t=null==o?void 0:o.decodedToken)||void 0===t?void 0:t.claims]}}))}))},e.prototype.isAuthenticated=function(){return o(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return[4,this.getUser()];case 1:return e=t.sent(),[2,Boolean(e)]}}))}))},e.prototype.checkSession=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),console.log("checking session"),[4,this.getTokenSilently(e)];case 1:return n.sent(),[3,3];case 2:if(t=n.sent(),!x.includes(t.error))throw t;return[3,3];case 3:return[2]}}))}))},e.prototype.getTokenSilently=function(e){return void 0===e&&(e={}),o(this,void 0,void 0,(function(){var t=this;return i(this,(function(r){return console.log("getting token silently on detailed response"),[2,(o=function(){return t._getTokenSilently(n(n({audience:t.options.audience,ignoreCache:!1},e),{scope:V(t.defaultScope,t.scope,e.scope)}))},i="".concat(this.options.client_id,"::").concat(this.options.audience,"::").concat(V(this.defaultScope,this.scope,e.scope)),s=K[i],s||(s=o().finally((function(){delete K[i],s=void 0})),K[i]=s),s)];var o,i,s}))}))},e.prototype._getTokenSilently=function(e){return void 0===e&&(e={}),o(this,void 0,void 0,(function(){var t,s,a,c,u,l,m,d,g;return i(this,(function(h){switch(h.label){case 0:return console.log("getting token silently verbose"),t=e.ignoreCache,s=r(e,["ignoreCache"]),console.log("_getTokenSilently",e),t||!s.scope?[3,2]:[4,this._getEntryFromCache({scope:s.scope,audience:s.audience||"default",client_id:this.options.client_id,getDetailedEntry:e.detailedResponse})];case 1:if(a=h.sent())return[2,a];h.label=2;case 2:return console.log("getting new token"),[4,(f=function(){return N.acquireLock("auth0.lock.getTokenSilently",5e3)},p=10,void 0===p&&(p=3),o(void 0,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:e=0,t.label=1;case 1:return e<p?[4,f()]:[3,4];case 2:if(t.sent())return[2,!0];t.label=3;case 3:return e++,[3,1];case 4:return[2,!1]}}))})))];case 3:if(!h.sent())return[3,15];h.label=4;case 4:return h.trys.push([4,,12,14]),t||!s.scope?[3,6]:[4,this._getEntryFromCache({scope:s.scope,audience:s.audience||"default",client_id:this.options.client_id,getDetailedEntry:e.detailedResponse})];case 5:if(a=h.sent())return[2,a];h.label=6;case 6:return this.options.useRefreshTokens?[4,this._getTokenUsingRefreshToken(s)]:[3,8];case 7:return u=h.sent(),[3,10];case 8:return[4,this._getTokenFromIfFrame(s)];case 9:u=h.sent(),h.label=10;case 10:return c=u,console.log("setting cache manager"),[4,this.cacheManager.set(n({client_id:this.options.client_id},c))];case 11:return h.sent(),e.detailedResponse?(console.log("checking detailed response"),l=c.id_token,m=c.access_token,d=c.oauthTokenScope,g=c.expires_in,[2,n(n({id_token:l,access_token:m},d?{scope:d}:null),{expires_in:g})]):[2,c.access_token];case 12:return console.log("releasing lock"),[4,N.releaseLock("auth0.lock.getTokenSilently")];case 13:return h.sent(),[7];case 14:return[3,16];case 15:throw console.log("could not acquire lock"),new S;case 16:return[2]}var f,p}))}))},e.prototype._getTokenUsingRefreshToken=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(e){throw"We currently don't support using refresh tokens, set useRefreshTokens to false"}))}))},e.prototype._getTokenFromIfFrame=function(e){return o(this,void 0,void 0,(function(){var t,s,a,c,l,m,d,h,A,v,w,y,b,x,k,_,T,S=this;return i(this,(function(C){switch(C.label){case 0:return t=p(f()),s=p(f()),a=f(),[4,(E=a,o(void 0,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return e=g().digest({name:"SHA-256"},(new TextEncoder).encode(E)),[3,1];case 1:return[4,e];case 2:return[2,t.sent()]}}))})))];case 1:c=C.sent(),I=new Uint8Array(c),l=function(e){var t={"+":"-","/":"_","=":""};return e.replace(/[+/=]/g,(function(e){return t[e]}))}(p(String.fromCharCode.apply(String,Array.from(I)))),console.log("checking params"),m=this._getParams(e,t,s,l,e.redirect_uri||this.options.redirect_uri),console.log("getting authorized url"),d=this._authorizeUrl(n(n({},m),{prompt:"none",response_mode:"web_message"})),console.log("setting timeout"),e.timeoutInSeconds||this.options.authorizeTimeoutInSeconds,C.label=2;case 2:return C.trys.push([2,8,,9]),h={active:!0,currentWindow:!0},console.log("checking current tab"),[4,u.tabs.query(h)];case 3:if(A=C.sent()[0],v=(A||{}).id,console.log("got current tab"),!v)throw"Could not access current tab.";return console.log("checking content script"),[4,u.tabs.sendMessage(v,"")];case 4:return C.sent(),console.log("getting result from child iframe"),[4,new Promise((function(e){var t=u.tabs.connect(v,{name:"auth0-web-extension::parent"}),n=function(r){console.log("hitting up child port",r.name),"auth0-web-extension::child"===r.name&&(r.onMessage.addListener((function(o){e(o),r.disconnect(),t.disconnect(),u.runtime.onConnect.removeListener(n)})),console.log("firing message to child port; name is ",r.name),r.postMessage({authorizeUrl:d,domainUrl:S.domainUrl}))};u.runtime.onConnect.addListener(n),t.postMessage({redirectUri:m.redirect_uri})}))];case 5:if(w=C.sent(),t!==w.state)throw new Error("Invalid state");return y=e.scope,b=e.audience,x=r(e,["scope","redirect_uri","audience","ignoreCache","timeoutInSeconds","detailedResponse"]),[4,D(n(n(n({},this.customOptions),x),{scope:y,audience:b,baseUrl:this.domainUrl,client_id:this.options.client_id,code_verifier:a,code:w.code,grant_type:"authorization_code",redirect_uri:m.redirect_uri,useFormData:this.options.useFormData,auth0Client:{}}))];case 6:return k=C.sent(),[4,this._verifyIdToken(k.id_token,s)];case 7:return _=C.sent(),[2,n(n({},k),{decodedToken:_,scope:m.scope,oauthTokenScope:k.scope,audience:m.audience||"default"})];case 8:throw(T=C.sent()).error,T;case 9:return[2]}var I,E}))}))},e.prototype._verifyIdToken=function(e,t,n){return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return[4,this.nowProvider()];case 1:return r=o.sent(),[2,M({iss:this.tokenIssuer,aud:this.options.client_id,id_token:e,nonce:t,organizationId:n,leeway:this.options.leeway,max_age:B(this.options.max_age),now:r})]}}))}))},e.prototype._getEntryFromCache=function(e){var t=e.scope,r=e.audience,s=e.client_id,a=e.getDetailedEntry,c=void 0!==a&&a;return o(this,void 0,void 0,(function(){var e,o,a,u,l;return i(this,(function(i){switch(i.label){case 0:return[4,this.cacheManager.get(new U({scope:t,audience:r,client_id:s}),60)];case 1:return(e=i.sent())&&e.access_token?c?(o=e.id_token,a=e.access_token,u=e.oauthTokenScope,l=e.expires_in,o&&l?[2,n(n({id_token:o,access_token:a},u?{scope:u}:null),{expires_in:l})]:[2,void 0]):[2,e.access_token]:[2]}}))}))},e}(),B=function(e){return"string"!=typeof e?e:parseInt(e,10)||void 0},W=function(e){return/^https?:\/\//.test(e)?e:"https://".concat(e)},$=((O={}).memory=function(){return(new F).enclosedCache},O),J=function(e){return $[e]},Z=function(e,t){return e?e.startsWith("https://")?e:"https://".concat(e,"/"):"".concat(t,"/")},H=function(e){return Array.from(new Set(e))},V=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return H(e.filter(Boolean).join(" ").trim().split(/\s+/)).join(" ")},G=function(e){return e.advancedOptions,e.audience,e.auth0Client,e.authorizeTimeoutInSeconds,e.cacheLocation,e.client_id,e.domain,e.issuer,e.leeway,e.max_age,e.redirect_uri,e.scope,e.useRefreshTokens,e.useCookiesForTransactions,e.useFormData,r(e,["advancedOptions","audience","auth0Client","authorizeTimeoutInSeconds","cacheLocation","client_id","domain","issuer","leeway","max_age","redirect_uri","scope","useRefreshTokens","useCookiesForTransactions","useFormData"])},Q=function(){};function X(e){var t=this;if(console.log("in handleTokenRequest"),window.location.origin===e){console.log("handleTokenRequest: redirectUri matches window.location.origin");u.runtime.connect(void 0,{name:"auth0-web-extension::child"}).onMessage.addListener((function(e,n){return o(t,void 0,void 0,(function(){var t,r,o;return i(this,(function(i){switch(i.label){case 0:return"auth0-web-extension::child"!==n.name?[3,2]:(t=e.authorizeUrl,r=e.domainUrl,[4,Y(t,r,60)]);case 1:o=i.sent(),n.postMessage(o),i.label=2;case 2:return[2]}}))}))}))}else console.log("handleTokenRequest: redirectUri does not match"),u.runtime.onConnect.addListener((function(t){if("auth0-web-extension::parent"===t.name){console.log("creating parent iframe");var n=function(){var r=document.createElement("iframe");r.setAttribute("width","0"),r.setAttribute("height","0"),r.style.display="none",document.body.appendChild(r),r.setAttribute("src",e),t.onMessage.removeListener(n),t.onDisconnect.addListener((function(){window.document.body.removeChild(r)}))};console.log("adding handler to port"),t.onMessage.addListener(n)}}))}var Y=function(e,t,n){return void 0===n&&(n=60),o(void 0,void 0,void 0,(function(){return i(this,(function(r){return console.log("runIFrame: starting"),[2,new Promise((function(r,o){var i=window.document.createElement("iframe");i.setAttribute("width","0"),i.setAttribute("height","0"),i.style.display="none";var s,a=function(){window.document.body.contains(i)&&(window.document.body.removeChild(i),window.removeEventListener("message",s,!1))},c=setTimeout((function(){o(new S),a()}),1e3*n);s=function(e){if(e.origin==t&&e.data&&"authorization_response"===e.data.type){var n=e.source;n&&n.close(),e.data.response.error?o(_.fromPayload(e.data.response)):r(e.data.response),clearTimeout(c),window.removeEventListener("message",s,!1),setTimeout(a,2e3)}},window.addEventListener("message",s,!1),window.document.body.appendChild(i),i.setAttribute("src",e)}))]}))}))};function ee(e){return new q(e)}export{q as Auth0Client,T as AuthenticationError,_ as GenericError,C as MfaRequiredError,S as TimeoutError,Q as User,ee as default,X as handleTokenRequest};
//# sourceMappingURL=auth0-web-extension.production.esm.js.map
